.container
  %p#notice= notice
  .row
    .col-md-6
      %h3
        = @demand.name
      .p.text-right
        = @demand.organization_profile.name_short_with_opf
      .well
        = @demand.description

      .well
        Выбраные компетенции:
        .choosed-compenences
          - @demand.competences.each do |competence|
            .btn.btn-default.btn-sm{id: "competence_#{competence.id}"}
              = competence.tag
              %span.badge{:id => "org_count_#{competence.id}"}= competence.organization_profiles.count  

      -if policy(@demand).edit?
        = link_to 'Edit', edit_demand_path(@demand)
        \|
      -if policy(@demand).index?
        = link_to 'Back', demands_path

    .col-md-6
      .h3 Запросы разъяснений
      .ul#explanations-list
        -if policy(@demand.explanations).index?
          = render @demand.explanations
        -# -else
        -#   Что бы просмотреть запросы разъяснений,
        -#   =link_to 'авторизуйтесь', login_path
        - cnt = @demand.explanations.count
        -# - byebug
        - if cnt == 0
          - if current_user.supplier?
            = render template: '/explanations/_form', |
                  locals: { demand: @demand, organization_profile_id: current_user.active_profile.id, |
                  user: current_user.id, question_id: nil, |
                  button_message: "Новый запрос:"}
        - elsif @demand.explanations.last.from_customer? && current_user.supplier?
          = render template: '/explanations/_form', |
          locals: { demand: @demand, organization_profile_id: current_user.active_profile.id, |
                          user: current_user.id, question_id: @demand.explanations.last.id, |
                          button_message: "Запросить больше подробностей на сообщение №#{@demand.explanations.last.id}"}
        - elsif @demand.explanations.last.from_supplier? && current_user.active_profile == @demand.organization_profile && current_user.customer?
          = render template: '/explanations/_form', |
          locals: { demand: @demand, organization_profile_id: current_user.active_profile.id, |
                          user: current_user.id, question_id: @demand.explanations.last.id, |
                          button_message: "Сообщить больше подробностей на запрос №#{@demand.explanations.last.id}"}

        -#
        -# -if policy(@demand).create_explanations?
        -#   = render template: '/explanations/_form', locals: {demand: @demand, organization_profile_id: @demand.organization_profile.id, user: current_user.id}
        -# -else
        -#   .well Запрос разъяснений могут формировать поставщики.
